# apiVersion: v1
# kind: Pod
# metadata:
#   name: {{ template "fullname" . }}-test
#   annotations:
#     "helm.sh/hook": test-success
# spec:
#   containers:
#     - name: test
#       image: cgswong/aws:aws
#       command:
#         - "sh"
#         - "-c"
#         - >
#           echo '[scality]' > ~/.aws/credentials ;
#           echo 'aws_access_key_id = {{ .Values.init_job.aws_access_key_id }}' >> ~/.aws/credentials ;
#           echo 'aws_secret_access_key = {{ .Values.init_job.aws_secret_access_key }}' >> ~/.aws/credentials ;
#           export S3_URL="http://{{ template "service_url" . }}:local:8000" ;
#           aws s3api create-bucket --endpoint-url $S3_URL --profile scality --bucket test-bucket ;
#           aws s3api put-object --endpoint-url $S3_URL --profile scality --bucket test-bucket --key etc/hosts --body /etc/hosts ;
#           set -e ;
#           [[ "$(aws s3api --endpoint-url $S3_URL list-objects-v2  --profile scality --bucket test-bucket | jq -r '.Contents[0].Key')" == "etc/hosts" ]] ;
#           aws s3api delete-object --endpoint-url $S3_URL --profile scality --bucket test-bucket  --key etc/hosts ;
#           aws s3api --endpoint-url $S3_URL delete-bucket --profile scality --bucket test-bucket ;
#           exit 0 ;
#   restartPolicy: Never